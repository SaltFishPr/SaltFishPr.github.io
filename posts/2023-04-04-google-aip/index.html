<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Google AIP - 咸鱼硕的博客</title><meta name=Description content="咸鱼硕的博客"><meta property="og:url" content="https://saltfishpr.github.io/posts/2023-04-04-google-aip/">
<meta property="og:site_name" content="咸鱼硕的博客"><meta property="og:title" content="Google AIP"><meta property="og:description" content="AIP (API Improvement Proposals) 是总结 Google API 设计决策的设计文档。
这里提供了一些常用文档的翻译。"><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-04T16:03:42+00:00"><meta property="article:modified_time" content="2024-08-07T22:42:32+08:00"><meta property="article:tag" content="Api Design"><meta property="og:image" content="https://saltfishpr.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://saltfishpr.github.io/logo.png"><meta name=twitter:title content="Google AIP"><meta name=twitter:description content="AIP (API Improvement Proposals) 是总结 Google API 设计决策的设计文档。
这里提供了一些常用文档的翻译。"><meta name=twitter:site content="@saltfishpr"><meta name=application-name content="咸鱼硕的博客"><meta name=apple-mobile-web-app-title content="咸鱼硕的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=go.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://saltfishpr.github.io/posts/2023-04-04-google-aip/><link rel=prev href=https://saltfishpr.github.io/posts/2023-04-04-grpc-jwt-auth/><link rel=next href=https://saltfishpr.github.io/posts/2024-01-31-photograph-2023/><link rel=stylesheet href=/css/style.min.61c0835a1733ac3f92b41b61b403dca9b8d4a3a7e4021c89af2c45a731f6343a82bc7fb214f4926e2c4669c8d258218b7da5d0e86d081ec97f3c1d823d48df2e.css integrity="sha512-YcCDWhczrD+StBthtAPcqbjUo6fkAhyJryxFpzH2NDqCvH+yFPSSbixGacjSWCGLfaXQ6G0IHsl/PB2CPUjfLg=="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Google AIP","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/saltfishpr.github.io\/posts\/2023-04-04-google-aip\/"},"image":["https:\/\/saltfishpr.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"api design","wordcount":9942,"url":"https:\/\/saltfishpr.github.io\/posts\/2023-04-04-google-aip\/","datePublished":"2023-04-04T16:03:42+00:00","dateModified":"2024-08-07T22:42:32+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/saltfishpr.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"Salt Fish"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=咸鱼硕的博客><span class=header-title-pre><i class="fas fa-code"></i></span>咸鱼硕的博客</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title=选择语言><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/posts/2023-04-04-google-aip/ selected>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=咸鱼硕的博客><span class=header-title-pre><i class="fas fa-code"></i></span>咸鱼硕的博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/posts/2023-04-04-google-aip/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Google AIP</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/saltfishpr title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Salt Fish</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/programming/><i class="far fa-folder fa-fw" aria-hidden=true></i>Programming</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-04-04>2023-04-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 9942 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 20 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#AIP-1><strong>AIP-1</strong> AIP 目的和指南</a></li><li><a href=#AIP-131><strong>AIP-131</strong> 标准方法：获取（Standard methods: Get）</a><ul><li><a href=#指导>指导</a></li><li><a href=#请求消息>请求消息</a></li><li><a href=#错误>错误</a></li><li><a href=#changelog>Changelog</a></li></ul></li><li><a href=#AIP-132><strong>AIP-132</strong> 标准方法：列表（Standard methods: List）</a><ul><li><a href=#指导-1>指导</a></li><li><a href=#请求消息-1>请求消息</a></li><li><a href=#响应消息>响应消息</a></li><li><a href=#排序>排序</a></li><li><a href=#过滤>过滤</a></li><li><a href=#软删除的资源>软删除的资源</a></li><li><a href=#错误-1>错误</a></li><li><a href=#延伸阅读>延伸阅读</a></li><li><a href=#changelog-1>Changelog</a></li></ul></li><li><a href=#AIP-133><strong>AIP-133</strong> 标准方法：创建（Standard methods: Create）</a><ul><li><a href=#指导-2>指导</a></li><li><a href=#请求消息-2>请求消息</a></li><li><a href=#长时间运行的创建long-running-create>长时间运行的创建（Long-running create）</a></li><li><a href=#用户指定的-id>用户指定的 ID</a></li><li><a href=#错误-2>错误</a></li><li><a href=#延伸阅读-1>延伸阅读</a></li><li><a href=#changelog-2>Changelog</a></li></ul></li><li><a href=#AIP-134><strong>AIP-134</strong> 标准方法：更新（Standard methods: Update）</a><ul><li><a href=#指导-3>指导</a></li><li><a href=#请求消息-3>请求消息</a></li><li><a href=#副作用>副作用</a></li><li><a href=#patch-和-put>PATCH 和 PUT</a></li><li><a href=#长时间运行的更新long-running-update>长时间运行的更新（Long-running update）</a></li><li><a href=#创建或更新>创建或更新</a></li><li><a href=#etags>Etags</a></li><li><a href=#昂贵的字段>昂贵的字段</a></li><li><a href=#错误-3>错误</a></li><li><a href=#changelog-3>Changelog</a></li></ul></li><li><a href=#AIP-135><strong>AIP-135</strong> 标准方法：删除（Standard methods: Delete）</a><ul><li><a href=#指导-4>指导</a></li><li><a href=#请求消息-4>请求消息</a></li><li><a href=#软删除>软删除</a></li><li><a href=#长时间运行的删除long-running-delete>长时间运行的删除（Long-running delete）</a></li><li><a href=#级联删除>级联删除</a></li><li><a href=#受保护的删除>受保护的删除</a></li><li><a href=#删除如果存在>删除（如果存在）</a></li><li><a href=#错误-4>错误</a></li><li><a href=#延伸阅读-2>延伸阅读</a></li><li><a href=#changelog-4>Changelog</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><a href=https://google.aip.dev/general target=_blank rel="noopener noreffer">AIP</a> (API Improvement Proposals) 是总结 Google API 设计决策的设计文档。</p><p>这里提供了一些常用文档的翻译。</p><h2 id=AIP-1><strong>AIP-1</strong> AIP 目的和指南</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>随着谷歌 API 语料库的发展，以及 API 治理团队的壮大，以满足支持它们的需求，越来越有必要为 API 生产者、审查者和其他相关方提供文档语料库以供参考。API 风格指南和介绍性的 One Platform 文档有意简洁而高级。AIP 集合提供了一种为 API 设计指南提供一致文档的方法。</p><h2 id=AIP-131><strong>AIP-131</strong> 标准方法：获取（Standard methods: Get）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在 REST API 中，为了检索资源，通常会向资源的 URI（例如 <code>/v1/publisher/{publisher}/books/{book}</code>）发出 <code>GET</code> 请求。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>Get</code> 方法来尊重这种模式。这些 RPC 接受表示该资源的 URI 并返回该资源。</p><h3 id=指导>指导</h3><p>API <font color=#c5221f>必须</font>为资源提供一个 get 方法。get 方法的目的是从单个资源返回数据。</p><p>Get 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>GetBook</span><span class=p>(</span><span class=n>GetBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Book</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>get</span><span class=o>:</span> <span class=s>&#34;/v1/{name=publishers/*/books/*}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;name&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以 <code>Get</code> 一词开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是资源消息名称的单数形式。</li><li>请求消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 后缀。</li><li>响应消息<font color=#c5221f>必须</font>是资源本身。（没有 <code>GetBookResponse</code>。）<ul><li>响应通常应包括完全填充的资源，除非有理由返回部分响应（见 <a href=#AIP-157 rel>AIP-157</a>）。</li></ul></li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>GET</code>。</li><li>URI <font color=#f57c00>应该</font>包含与资源名称相对应的单个变量字段。<ul><li>此字段应称为 <code>name</code>。</li><li>URI <font color=#f57c00>应该</font>有一个与此字段相对应的变量。</li><li><code>name</code> 字段<font color=#f57c00>应该</font>是 URI 路径中唯一的变量。所有剩余的参数都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li></ul></li><li><code>google.api.http</code> 注解中<font color=#c5221f>不能</font>有 <code>body</code> 键。</li><li><font color=#f57c00>应该</font>只有一个值为 <code>"name"</code> 的 <code>google.api.method_signature</code> 注解。</li></ul><h3 id=请求消息>请求消息</h3><p>Get 方法实现了一个通用的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>GetBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The name of the book to retrieve.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><font color=#c5221f>必须</font>包含资源名称字段。它<font color=#f57c00>应该</font>被称为 name。<ul><li><font color=#f57c00>应该</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识其引用的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li><code>name</code> 字段的注释<font color=#f57c00>应该</font>记录资源模式。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除其他 AIP 中描述的字段之外的其他可选字段。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>请求对象中的 <code>name</code> 字段对应于 RPC 上 <code>google.api.http</code> 注解中的 <code>name</code> 变量。因为在使用 REST/JSON 接口时，根据 URL 中的值填充 request 中的 <code>name</code> 字段。</div></div></div><h3 id=错误>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><h3 id=changelog>Changelog</h3><ul><li>2023-03-17: Align with AIP-122 and make Get a must.</li><li>2022-11-04: Aggregated error guidance to AIP-193.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-12: Added guidance for error cases.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul><h2 id=AIP-132><strong>AIP-132</strong> 标准方法：列表（Standard methods: List）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在许多 API 中，通常会向集合的 URI（例如 <code>/v1/publisher/1/books</code>）发出 <code>GET</code> 请求，以便检索资源列表，每个资源都位于该集合中。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>List</code> 方法来尊重这种模式。这些 RPC 接受父集合（可能还有一些其他参数），并返回与该输入匹配的响应列表。</p><h3 id=指导-1>指导</h3><p>API <font color=#c5221f>必须</font>为资源提供 <code>List</code> 方法，除非资源是<a href=#AIP-156 rel>单例</a>。<code>List</code> 方法的目的是从有限集合返回数据（通常是单个集合，除非操作支持<a href=#AIP-159 rel>跨集合读取</a>）。</p><p>List 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>ListBooks</span><span class=p>(</span><span class=n>ListBooksRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>ListBooksResponse</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>get</span><span class=o>:</span> <span class=s>&#34;/v1/{parent=publishers/*}/books&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;parent&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以单词 <code>List</code> 开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是所列资源的复数形式。</li><li>请求和响应消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 和 <code>Response</code> 后缀。</li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>GET</code>。</li><li>列出其资源的集合<font color=#f57c00>应该</font>映射到 URI 路径。<ul><li>集合的父资源<font color=#f57c00>应</font>称为 <code>parent</code>，并且<font color=#f57c00>应</font>是 URI 路径中唯一的变量。所有剩余的参数都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li><li>集合标识符（上例中的 books）<font color=#c5221f>必须</font>是一个文本字符串。</li></ul></li><li><code>google.api.http</code> 注解中的 <code>body</code> 键<font color=#c5221f>必须</font>省略。</li><li>如果列出的资源不是顶级资源，那么<font color=#f57c00>应该</font>只有一个值为 <code>"parent"</code> 的 <code>google.api.method_signature</code> 注解。如果列出的资源是顶级资源，则<font color=#f57c00>应该</font>没有 <code>google.api.method_signature</code> 注解，或者只有一个值为 <code>""</code> 的 <code>google.api.method_signature</code> 注解。</li></ul><h3 id=请求消息-1>请求消息</h3><p>List 方法实现了一种常见的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>ListBooksRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The parent, which owns this collection of books.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>parent</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>child_type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The maximum number of books to return. The service may return fewer than
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// this value.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// If unspecified, at most 50 books will be returned.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// The maximum value is 1000; values above 1000 will be coerced to 1000.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int32</span> <span class=n>page_size</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// A page token, received from a previous `ListBooks` call.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Provide this to retrieve the subsequent page.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// When paginating, all other parameters provided to `ListBooks` must match
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// the call that provided the page token.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>page_token</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>除非列出的资源是顶级资源，否则<font color=#c5221f>必须</font>包括 <code>parent</code> 字段。它应该被称为 <code>parent</code>。<ul><li><font color=#f57c00>应</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识所列资源的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li><font color=#c5221f>必须</font>在所有列表请求消息上指定支持分页的 <code>page_size</code> 和 <code>page_token</code> 字段。有关更多信息，请参阅 <a href=#AIP-158 rel>AIP-158</a>。<ul><li><code>page_size</code> 字段上方的注释<font color=#f57c00>应</font>记录允许的最大值，以及省略（或设置为 <code>0</code>）字段时的默认值。如果首选 (<em>If preferred</em>)，API <font color=#188038>可以</font>声明服务器将使用合理的默认值。此默认值<font color=#188038>可</font>会随着时间的推移而更改。</li><li>如果用户提供的值大于允许的最大值，则 API <font color=#f57c00>应</font>将该值强制为允许的最大。</li><li>如果用户提供了负值或其他无效值，则 API <font color=#c5221f>必须</font>返回 <code>INVALID_ARGUMENT</code> 错误。</li></ul></li><li><code>page_token</code> 字段<font color=#c5221f>必须</font>包含在所有列表请求消息中。</li><li>请求消息<font color=#188038>可以</font>包括与列表方法相关的常见设计模式的字段，例如 <code>string filter</code> 和 <code>string order_by</code>。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除本 AIP 或其他 AIP 中描述的字段之外的其他可选字段。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>对于任何有权对集合成功发出 List 请求的用户，List 方法都<font color=#f57c00>应该</font>返回相同的结果。Search 方法在这方面比较宽松。</div></div></div><h3 id=响应消息>响应消息</h3><p>List 方法实现了一个通用的响应消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>ListBooksResponse</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The books from the specified publisher.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>repeated</span> <span class=n>Book</span> <span class=n>books</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// A token, which can be sent as `page_token` to retrieve the next page.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// If this field is omitted, there are no subsequent pages.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>next_page_token</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>响应消息<font color=#c5221f>必须</font>包括一个与返回的资源相对应的重复字段，并且<font color=#f57c00>不应</font>包括任何其他重复字段，除非在另一个 AIP（例如，<a href=#AIP-217 rel>AIP-217</a>）中描述。<ul><li>响应通常<font color=#f57c00>应</font>包括完全填充的资源，除非有理由返回部分响应（见 <a href=#AIP-157 rel>AIP-157</a>）。</li></ul></li><li>支持分页的 <code>next_page_token</code> 字段<font color=#c5221f>必须</font>包含在所有列表响应消息中。如果有后续页面，则<font color=#c5221f>必须</font>设置它，如果响应表示最终页面，则<font color=#c5221f>不得</font>设置它。有关更多信息，请参阅 <a href=#AIP-158 rel>AIP-158</a>。</li><li>该消息<font color=#188038>可以</font>包括具有集合中的项数的 <code>int32 total_size</code>（或 <code>int64 total_size</code>）字段。<ul><li>该值<font color=#188038>可以</font>是一个估计值（如果是的话，字段<font color=#f57c00>应该</font>清楚地记录在文档中）。</li><li>如果使用筛选，则 <code>total_size</code> 字段<font color=#f57c00>应</font>反映应用筛选后集合的大小。</li></ul></li></ul><h3 id=排序>排序</h3><p><code>List</code> 方法<font color=#188038>可以</font>允许客户端指定排序顺序；如果他们这样做了，那么请求消息<font color=#f57c00>应该</font>包含一个 <code>string order_by</code> 字段。</p><ul><li>值<font color=#f57c00>应该</font>是以逗号分隔的字段列表。例如：<code>"foo,bar"</code>。</li><li>默认的排序顺序是升序。为了指定字段的降序，用户会附加一个 <code>" desc"</code> 后缀；例如：<code>"foo desc, bar"</code>。</li><li>语法中多余的空格字符是无关紧要的。<code>"foo, bar desc"</code>、<code>" foo , bar desc "</code>和 <code>"foo,bar desc"</code> 都是等价的。</li><li>子字段是用指定的。字符，例如 <code>foo.bar</code> 或 <code>address.street</code>。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>只有在确定需要的情况下才提供排序。以后随时可以添加排序，但删除它是一个破坏性的改变。</div></div></div><h3 id=过滤>过滤</h3><p><code>List</code> 方法<font color=#188038>可以</font>允许客户端指定筛选器；如果他们这样做了，那么请求消息应该包含一个 <code>string filter</code> 字段。过滤在 <a href=#AIP-160 rel>AIP-160</a> 中有更详细的描述。</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>只有在确定需要的情况下才提供筛选。以后随时是可以添加筛选，但删除它是一个破坏性的改变。</div></div></div><h3 id=软删除的资源>软删除的资源</h3><p>一些 API 需要“<a href=#AIP-135 rel>软删除</a>”资源，将其标记为已删除或待删除（并可选择稍后清除）。</p><p>默认情况下，执行此操作的 API <font color=#f57c00>不应</font>在列表请求中包括已删除的资源。具有软删除资源的 API <font color=#f57c00>应</font>在列表请求中包括一个 <code>bool show_deleted</code> 字段，如果设置该字段，将导致软删除的资源被包括在内。</p><h3 id=错误-1>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><h3 id=延伸阅读>延伸阅读</h3><ul><li>有关分页的详细信息，请参阅 <a href=#AIP-158 rel>AIP-158</a>。</li><li>有关跨多个父集合的列表，请参见 <a href=#AIP-159 rel>AIP-159</a>。</li></ul><h3 id=changelog-1>Changelog</h3><ul><li>2023-03-22: Fix guidance wording to mention AIP-159.</li><li>2023-03-17: Align with AIP-122 and make Get a must.</li><li>2022-11-04: Aggregated error guidance to AIP-193.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2020-09-02: Add link to the filtering AIP.</li><li>2020-08-14: Added error guidance for permission denied cases.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2020-05-19: Removed requirement to document ordering behavior.</li><li>2020-04-15: Added guidance on List permissions.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-07-30: Added guidance about documenting the ordering behavior.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul><h2 id=AIP-133><strong>AIP-133</strong> 标准方法：创建（Standard methods: Create）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在 REST API 中，通常会向集合的 URI（例如 <code>/v1/publisher/{publisher}/books</code>）发出 <code>POST</code> 请求，以便在该集合中创建新的资源。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>Create</code> 方法来尊重这种模式。这些 RPC 接受父集合和要创建的资源（可能还有一些其他参数），并返回创建的资源。</p><h3 id=指导-2>指导</h3><p>API 通常<font color=#f57c00>应该</font>为资源提供一个<em>创建</em>方法，除非这样做对用户来说没有价值。<em>创建</em>方法的目的是在已经存在的集合中创建一个新的资源。</p><p>Create 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>CreateBook</span><span class=p>(</span><span class=n>CreateBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Book</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>post</span><span class=o>:</span> <span class=s>&#34;/v1/{parent=publishers/*}/books&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>body</span><span class=o>:</span> <span class=s>&#34;book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;parent,book&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以 <code>Create</code> 一词开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是正在创建的资源的单数形式。</li><li>请求消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 后缀。</li><li>响应消息<font color=#c5221f>必须</font>是资源本身。没有 <code>CreateBookResponse</code>。<ul><li>响应<font color=#f57c00>应</font>包括完全填充的资源，并且<font color=#c5221f>必须</font>包括所提供的任何字段，除非它们仅是输入的（见 <a href=#AIP-203 rel>AIP-203</a>）。</li><li>如果创建 RPC 是长时间运行的，则响应消息<font color=#c5221f>必须</font>是解析为资源本身的 <code>google.longrunning.Operation</code>。</li></ul></li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>POST</code>。</li><li>添加资源的集合<font color=#f57c00>应该</font>映射到 URI 路径。<ul><li>集合的父资源<font color=#f57c00>应</font>称为 <code>parent</code>，并且<font color=#f57c00>应</font>是 URI 路径中唯一的变量。</li><li>集合标识符（上例中的 <code>books</code>）<font color=#c5221f>必须</font>是一个文本字符串。</li></ul></li><li><code>google.api.http</code> 注解中<font color=#c5221f>必须</font>有一个 <code>body</code> 键，并且它<font color=#c5221f>必须</font>映射到请求消息中的资源字段。<ul><li>所有剩余的字段都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li></ul></li><li><font color=#f57c00>应该</font>只有一个 <code>google.api.method_signature</code> 注解，如果要创建的资源不是顶级资源，则其值为 <code>"parent，{resource}"</code>，如果正在创建的资源是顶级资源（除非该方法支持<a href=#AIP-133 rel>用户指定的 ID</a>），则该注解的值为 <code>"{resource}"</code>。</li></ul><h3 id=请求消息-2>请求消息</h3><p>Create 方法实现一个通用的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>CreateBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The parent resource where this book will be created.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>parent</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>child_type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to create.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=mi>2</span> <span class=p>[(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>除非正在创建的资源是顶级资源，否则<font color=#c5221f>必须</font>包括 <code>parent</code> 字段。它<font color=#f57c00>应该</font>被称为 <code>parent</code>。<ul><li><font color=#f57c00>应</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识正在创建的资源的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li>资源字段<font color=#c5221f>必须</font>包含在内，并且<font color=#c5221f>必须</font>映射到 POST body。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除本 AIP 或其他 AIP 中描述的字段之外的其他可选字段。</li></ul><h3 id=长时间运行的创建long-running-create>长时间运行的创建（Long-running create）</h3><p>有些资源创建资源所花费的时间比常规 API 请求所需的时间更长。在这种情况下，API <font color=#f57c00>应该</font>使用长时间运行的操作（<a href=#AIP-151 rel>AIP-151</a>）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>CreateBook</span><span class=p>(</span><span class=n>CreateBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>google.longrunning.Operation</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>post</span><span class=o>:</span> <span class=s>&#34;/v1/{parent=publishers/*}/books&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.longrunning.operation_info</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>response_type</span><span class=o>:</span> <span class=s>&#34;Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>metadata_type</span><span class=o>:</span> <span class=s>&#34;OperationMetadata&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>响应类型<font color=#c5221f>必须</font>设置为资源（如果 RPC 不是长时间运行的，则返回类型是什么）。</li><li><font color=#c5221f>必须</font>同时指定 <code>response_type</code> 和 <code>metadata_type</code> 字段。</li></ul><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>重要<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#f57c00>应该</font>使用长时间运行的操作。如果请求实际上是即时的，则服务<font color=#188038>可以</font>返回已经设置为完成的 LRO。</div></div></div><h3 id=用户指定的-id>用户指定的 ID</h3><p>有时，API 需要允许客户端在创建时指定资源的 ID 组件（资源名称的最后一段）。如果允许用户选择其资源名称的这一部分，这是很常见的。</p><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>// Using user-specified IDs.
</span></span><span class=line><span class=cl>publishers/lacroix/books/les-miserables
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Using system-generated IDs.
</span></span><span class=line><span class=cl>publishers/012345678-abcd-cdef/books/12341234-5678-abcd
</span></span></code></pre></td></tr></table></div></div><p>创建 RPC <font color=#188038>可以</font>通过在请求消息上提供字符串 <code>{resource}_id</code> 字段来支持此行为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>CreateBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The parent resource where this book will be created.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>parent</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>child_type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to create.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=mi>2</span> <span class=p>[(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The ID to use for the book, which will become the final component of
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// the book&#39;s resource name.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// This value should be 4-63 characters, and valid characters
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// are /[a-z][0-9]-/.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>book_id</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>{resource}_id</code> 字段<font color=#c5221f>必须</font>存在于请求消息中，而不是资源本身。<ul><li>该字段<font color=#188038>可以</font>是必需的，也可以是可选的。如果是必需的，它<font color=#f57c00>应该</font>包括相应的注释。</li></ul></li><li><font color=#c5221f>必须</font>忽略资源上的 <code>name</code> 字段。</li><li>RPC 上<font color=#f57c00>应该</font>只有一个 <code>google.api.method_signature</code> 注解，如果正在创建的资源不是顶级资源，则其值为 <code>"parent,{resource},{resource}_id"</code>；如果要创建的资源是顶级资源，其值应为 <code>"{resource},{resource}_id"</code>。</li><li>文档<font color=#f57c00>应</font>解释什么是可接受的格式，并且该格式<font color=#f57c00>应</font>遵循 <a href=#AIP-122 rel>AIP-122</a> 中的资源名称格式指南。</li><li>如果用户试图创建一个 ID 会导致资源名称重复的资源，则该服务<font color=#c5221f>必须</font>返回 <code>ALREADY_EXISTS</code> 错误。<ul><li>但是，如果进行调用的用户没有查看重复资源的权限，则服务<font color=#c5221f>必须</font>改为使用 <code>PERMISSION_DENIED</code>。</li></ul></li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>对于 REST API，用户指定的 ID 字段 <code>{resource}_id</code> 作为请求 URI 上的查询参数提供。</div></div></div><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>重要<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#c5221f>必须</font>支持用户指定的 ID。</div></div></div><h3 id=错误-2>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><h3 id=延伸阅读-1>延伸阅读</h3><ul><li>要确保 <code>Create</code> 方法中的幂等性，请参见 <a href=#AIP-155 rel>AIP-155</a>。</li><li>有关涉及 Unicode 的命名资源，请参见 <a href=#AIP-210 rel>AIP-210</a>。</li></ul><h3 id=changelog-2>Changelog</h3><ul><li>2022-11-04: Referencing aggregated error guidance in AIP-193, similar to other CRUDL AIPs.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2020-10-06: Added declarative-friendly guidance.</li><li>2020-08-14: Updated error guidance to use permission denied over forbidden.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2019-11-22: Added clarification on what error to use if a duplicate name is sent.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-06-10: Added guidance for long-running create.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul><h2 id=AIP-134><strong>AIP-134</strong> 标准方法：更新（Standard methods: Update）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在 REST API 中，通常对资源的 URI（例如 <code>/v1/publisher/{publisher}/books/{book}</code>）发出 <code>PATCH</code> 或 <code>PUT</code> 请求，以更新该资源。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>Update</code> 方法（反映 REST <code>PATCH</code> 行为）来尊重这种模式。这些 RPC 接受表示该资源的 URI 并返回该资源。</p><h3 id=指导-3>指导</h3><p>API 通常<font color=#f57c00>应该</font>为资源提供更新方法，除非这样做对用户没有价值。更新方法的目的是在不造成副作用的情况下对资源进行更改。</p><p>Update 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>UpdateBook</span><span class=p>(</span><span class=n>UpdateBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Book</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>patch</span><span class=o>:</span> <span class=s>&#34;/v1/{book.name=publishers/*/books/*}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>body</span><span class=o>:</span> <span class=s>&#34;book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;book,update_mask&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以单词 <code>Update</code> 开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是资源消息名称的单数形式。</li><li>请求消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 后缀。</li><li>响应消息<font color=#c5221f>必须</font>是资源本身。（没有 <code>UpdateBookResponse</code>。）<ul><li>响应<font color=#f57c00>应</font>包括完全填充的资源，并且<font color=#c5221f>必须</font>包括已发送并包含在更新掩码中的任何字段，除非它们只是输入的（请参阅 <a href=#AIP-203 rel>AIP-203</a>）。</li><li>如果更新 RPC 是<a href=#AIP-134 rel>长时间运行的</a>，则响应消息<font color=#c5221f>必须</font>是解析为资源本身的 <code>google.longrunning.Operation</code>。</li></ul></li><li>该方法<font color=#f57c00>应该</font>支持部分资源更新，HTTP 谓词应该是 <code>PATCH</code>。<ul><li>如果该方法只支持完全资源替换，那么 HTTP 谓词<font color=#188038>可以</font>是 <code>PUT</code>。然而，强烈反对这样做，因为向资源中添加字段会成为向后不兼容的更改。</li></ul></li><li>资源的 <code>name</code> 字段<font color=#f57c00>应该</font>映射到 URI 路径。<ul><li><code>{resource}.name</code> 字段<font color=#f57c00>应该</font>是 URI 路径中的唯一变量。</li></ul></li><li><code>google.api.http</code> 注解中<font color=#c5221f>必须</font>有一个 <code>body</code> 键，并且它<font color=#c5221f>必须</font>映射到请求消息中的 resource 字段。<ul><li>所有剩余的字段都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li></ul></li><li><font color=#f57c00>应该</font>只有一个 <code>google.api.method_signature</code> 注解，其值为 <code>"{resource},update_mask"</code>。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>与其他四种标准方法不同，这里的 URI 路径引用了示例中的嵌套字段（<code>book.name</code>）。如果资源字段有单词分隔符，则使用 <code>snake_case</code>。</div></div></div><h3 id=请求消息-3>请求消息</h3><p>Update 方法实现了一个通用的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>UpdateBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to update.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// The book&#39;s `name` field is used to identify the book to update.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The list of fields to update.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>google.protobuf.FieldMask</span> <span class=n>update_mask</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>请求消息<font color=#c5221f>必须</font>包含资源的字段。<ul><li>字段<font color=#c5221f>必须</font>映射到 <code>PATCH</code> 主体。</li><li><font color=#f57c00>应</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>资源消息中<font color=#c5221f>必须</font>包含 <code>name</code> 字段。它<font color=#f57c00>应该</font>被称为 <code>name</code>。</li><li>该字段<font color=#c5221f>必须</font>标识要更新的资源的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li>如果支持部分资源更新，则<font color=#c5221f>必须</font>包含字段掩码。它的类型<font color=#c5221f>必须</font>是 <code>google.protobuf.FieldMask</code>，并且应该称为 <code>update_mask</code>。<ul><li>字段掩码中使用的字段对应于正在更新的资源（而不是请求消息）。</li><li>该字段<font color=#188038>可以</font>是必需的，也可以是可选的。如果是必须的，则<font color=#c5221f>必须</font>包含相应的注释。如果可选，则服务<font color=#c5221f>必须</font>将省略的字段掩码视为隐含字段掩码，该隐含字段掩码等效于填充的所有字段（具有非空值）。</li><li>更新掩码<font color=#c5221f>必须</font>支持一个特殊值 <code>*</code>，这意味着完全替换（相当于 <code>PUT</code>）。</li></ul></li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除本 AIP 或其他 AIP 中描述的字段之外的其他可选字段。</li></ul><h3 id=副作用>副作用</h3><p>通常，更新方法旨在更新资源中的数据。更新方法<font color=#f57c00>不应</font>引发其他副作用。相反，副作用<font color=#f57c00>应该</font>由自定义方法触发。</p><p>特别是，这要求<a href=#AIP-216 rel>状态</a>字段在更新方法中<font color=#c5221f>不能</font>直接写入。</p><h3 id=patch-和-put>PATCH 和 PUT</h3><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw" aria-hidden=true></i>TL;DR<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>Google API 通常只使用 <code>PATCH</code> HTTP 谓词，不支持 <code>PUT</code> 请求。</div></div></div><p>我们在 <code>PATCH</code> 上实现了标准化，因为谷歌通过向后兼容的改进来更新稳定的 API。通常有必要向现有资源中添加一个新字段，但在使用 <code>PUT</code> 时，这将成为一个破坏性的更改。</p><p>为了说明这一点，考虑对 <code>Book</code> 资源的 <code>PUT</code> 请求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>PUT /v1/publishers/123/books/456
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{&#34;title&#34;: &#34;Mary Poppins&#34;, &#34;author&#34;: &#34;P.L. Travers&#34;}
</span></span></code></pre></td></tr></table></div></div><p>接下来，考虑资源稍后会添加一个新字段（此处我们添加 <code>rating</code>）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>Book</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>title</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=kt>string</span> <span class=n>author</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// Subsequently added to v1 in place...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int32</span> <span class=n>rating</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>如果对一本书设置了评级，并且执行了现有的 <code>PUT</code> 请求，那么它将清除该书的评级。从本质上讲，<code>PUT</code> 请求无意中擦除了数据，因为以前的版本并不知道这一点。</p><h3 id=长时间运行的更新long-running-update>长时间运行的更新（Long-running update）</h3><p>某些资源更新资源所需的时间比常规 API 请求所需的合理时间要长。在这种情况下，API <font color=#f57c00>应该</font>使用长时间运行的操作（<a href=#AIP-151 rel>AIP-151</a>）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>UpdateBook</span><span class=p>(</span><span class=n>UpdateBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>google.longrunning.Operation</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>patch</span><span class=o>:</span> <span class=s>&#34;/v1/{book.name=publishers/*/books/*}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.longrunning.operation_info</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>response_type</span><span class=o>:</span> <span class=s>&#34;Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>metadata_type</span><span class=o>:</span> <span class=s>&#34;OperationMetadata&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>响应类型<font color=#c5221f>必须</font>设置为资源（如果 RPC 不是长时间运行的，则返回类型是什么）。</li><li><font color=#c5221f>必须</font>同时指定 <code>response_type</code> 和 <code>metadata_type</code> 字段。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#f57c00>应该</font>使用长时间运行的更新</div></div></div><h3 id=创建或更新>创建或更新</h3><p>如果服务使用客户端分配的资源名称，<code>Update</code> 方法<font color=#188038>可以</font>暴露一个 <code>bool allow_missing</code> 字段，这将使该方法在用户尝试更新不存在的资源时成功（并将在此过程中创建资源）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>UpdateBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to update.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// The book&#39;s `name` field is used to identify the book to be updated.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The list of fields to be updated.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>google.protobuf.FieldMask</span> <span class=n>update_mask</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// If set to true, and the book is not found, a new book will be created.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// In this situation, `update_mask` is ignored.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>bool</span> <span class=n>allow_missing</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>更具体地说，<code>allow_missing</code> 标志触发以下行为：</p><ul><li>如果方法调用所在的资源不存在，则会创建该资源。应用所有字段，而不考虑提供的任何字段掩码。<ul><li>但是，如果缺少任何必需的字段或字段的值无效，则会返回 <code>INVALID_ARGUMENT</code> 错误。</li></ul></li><li>如果方法调用位于已存在的资源上，并且所有字段都匹配，则返回的现有资源不变。</li><li>如果方法调用位于已存在的资源上，则只更新字段掩码中声明的字段。</li></ul><p>即使 <code>allow_missing</code> 设置为 <code>true</code>，用户也<font color=#c5221f>必须</font>具有调用 <code>Update</code> 的更新权限。对于希望阻止用户使用更新方法创建资源的客户，<font color=#f57c00>应</font>使用 IAM（Identity and Access Management）条件。</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#c5221f>必须</font>公开 <code>bool allow_missing</code> 字段。</div></div></div><h3 id=etags>Etags</h3><p>API 有时可能需要允许用户发送更新请求，这些更新请求保证是根据最新数据进行的（这方面的一个常见用例是检测和避免竞争条件）。需要启用此功能的资源通过包含一个 <code>string etag</code> 字段来实现，该字段包含一个不透明的、由服务器计算的值，表示资源的内容。</p><p>在这种情况下，资源<font color=#f57c00>应该</font>包含一个 <code>string etag</code> 字段：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>Book</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The resource name of the book.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The title of the book.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Example: &#34;Mary Poppins&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>title</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The author of the book.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Example: &#34;P.L. Travers&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>author</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The etag for this book.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// If this is provided on update, it must match the server&#39;s etag.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>etag</span> <span class=o>=</span> <span class=mi>4</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>etag 字段<font color=#188038>可以</font>是必需的，也可以是可选的。如果设置了它，则<font color=#c5221f>只有</font>当且仅当提供的 etag 与服务器计算的值匹配时，请求才能成功，否则<font color=#c5221f>必须</font>以 <code>ABORTED</code> 错误失败。请求中的 <code>update_mask</code> 字段不会影响 <code>etag</code> 字段的行为，因为它不是<em>正在</em>更新的字段。</p><h3 id=昂贵的字段>昂贵的字段</h3><p>API 有时会遇到资源上的某些字段昂贵或无法可靠返回的情况。</p><p>这种情况可能发生在几种情况下：</p><ul><li>资源可能具有一些计算成本非常高的字段，并且这些字段通常对客户的更新请求没有用处。</li><li>单个资源有时表示来自多个底层（最终是一致的）数据源的数据的合并。在这些情况下，不可能返回未更改字段的权威信息。</li></ul><p>在这种情况下，API <font color=#188038>可以</font>只返回已更新的字段，而忽略其余字段，如果这样做，则<font color=#f57c00>应该</font>记录此行为。</p><h3 id=错误-3>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><p>此外，如果用户确实具有适当的权限，但所请求的资源不存在，则除非 <code>allow_missing</code> 设置为 <code>true</code>，否则服务<font color=#c5221f>必须</font>出现 <code>NOT_FOUND</code>（HTTP 404）错误</p><h3 id=changelog-3>Changelog</h3><ul><li>2022-11-04: Aggregated error guidance to AIP-193.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2021-11-04: Changed the permission check if allow_missing is set.</li><li>2021-07-08: Added error guidance for resource not found case.</li><li>2021-03-05: Changed the etag error from FAILED_PRECONDITION (which becomes HTTP 400) to ABORTED (409).</li><li>2020-10-06: Added guidance for declarative-friendly resources.</li><li>2020-10-06: Added guidance for allow_missing.</li><li>2020-08-14: Added error guidance for permission denied cases.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-09-10: Added a link to the long-running operations AIP.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-06-10: Added guidance for long-running update.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul><h2 id=AIP-135><strong>AIP-135</strong> 标准方法：删除（Standard methods: Delete）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-06</div></div></div><p>在 REST API 中，通常对资源的 URI（例如 <code>/v1/publisher/{publisher}/books/{book}</code>）发出 <code>DELETE</code> 请求以删除该资源。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>Delete</code> 方法来尊重这种模式。这些 RPC 接受表示该资源的 URI，并且通常返回一个空响应。</p><h3 id=指导-4>指导</h3><p>API 通常<font color=#f57c00>应该</font>为资源提供一个删除方法，除非这样做对用户来说没有价值。</p><p>Delete 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>DeleteBook</span><span class=p>(</span><span class=n>DeleteBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>google.protobuf.Empty</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>delete</span><span class=o>:</span> <span class=s>&#34;/v1/{name=publishers/*/books/*}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;name&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以 <code>Delete</code> 一词开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是资源消息名称的单数形式。</li><li>请求消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 后缀。</li><li>响应消息<font color=#f57c00>应该</font>是 <code>google.protobuf.Empty</code>。<ul><li>如果资源被<a href=#AIP-135 rel>软删除</a>，那么响应消息<font color=#f57c00>应该</font>是资源本身。</li><li>如果删除 RPC 是<a href=#AIP-134 rel>长时间运行的</a>，则响应消息<font color=#c5221f>必须</font>是解析为正确响应的 <code>google.longrunning.Operation</code>。</li></ul></li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>DELETE</code>。</li><li>接收资源名称的请求消息字段<font color=#f57c00>应该</font>映射到 URI 路径。<ul><li>此字段应称为 <code>name</code>。</li><li><code>name</code> 字段<font color=#f57c00>应该</font>是 URI 路径中唯一的变量。所有剩余的参数都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li></ul></li><li><code>google.api.http</code> 注释中<font color=#c5221f>不能</font>有 <code>body</code> 键。</li><li><font color=#f57c00>应该</font>只有一个值为 <code>"name"</code> 的 <code>google.api.method_signature</code> 注释。如果使用了 <code>etag</code> 或 <code>force field</code>，它们<font color=#188038>可以</font>包含在签名中。</li></ul><p>如果并且仅当资源存在并且已成功删除时，Delete 方法<font color=#f57c00>应</font>成功。如果资源不存在，则该方法<font color=#f57c00>应</font>返回 <code>NOT_FOUND</code> 错误。</p><h3 id=请求消息-4>请求消息</h3><p>Delete 方法实现了一种常见的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>DeleteBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The name of the book to delete.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><font color=#c5221f>必须</font>包含 <code>name</code> 字段。它<font color=#f57c00>应该</font>被称为 <code>name</code>。<ul><li><font color=#f57c00>应</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识其引用的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li>字段的注释<font color=#f57c00>应该</font>记录资源模式。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除本 AIP 或其他 AIP 中描述的字段之外的其他可选字段。</li></ul><h3 id=软删除>软删除</h3><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>该材料被移到自己的文件中，以提供更全面的处理：<a href=#AIP-164 rel>AIP-164</a>。</div></div></div><h3 id=长时间运行的删除long-running-delete>长时间运行的删除（Long-running delete）</h3><p>某些资源删除资源所需的时间比常规 API 请求所需的合理时间要长。在这种情况下，API <font color=#f57c00>应该</font>使用长时间运行的操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>DeleteBook</span><span class=p>(</span><span class=n>DeleteBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>google.longrunning.Operation</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>delete</span><span class=o>:</span> <span class=s>&#34;/v1/{name=publishers/*/books/*}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.longrunning.operation_info</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>response_type</span><span class=o>:</span> <span class=s>&#34;google.protobuf.Empty&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>metadata_type</span><span class=o>:</span> <span class=s>&#34;OperationMetadata&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>如果 RPC 不是长时间运行的，则响应类型<font color=#c5221f>必须</font>设置为适当的返回类型：对于大多数 Delete RPC，为 <code>google.protobuf.Empty</code>；对于软删除，为资源本身（<a href=#AIP-164 rel>AIP-164</a>）。</li><li><font color=#c5221f>必须</font>同时指定 <code>response_type</code> 和 <code>metadata_type</code> 字段（即使它们是 <code>google.protobuf.Empty</code>）。</li></ul><h3 id=级联删除>级联删除</h3><p>有时，用户可能需要删除资源以及所有适用的子资源。然而，由于删除通常是永久性的，让用户不要意外地删除也很重要，因为重建被删除的子资源可能相当困难。</p><p>如果 API 允许删除可能具有子资源的资源，则 API <font color=#f57c00>应</font>在请求上提供 <code>bool force</code> 字段，用户将其设置为明确选择级联删除。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>DeletePublisherRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The name of the publisher to delete.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Publisher&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// If set to true, any books from this publisher will also be deleted.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// (Otherwise, the request will only work if the publisher has no books.)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>bool</span> <span class=n>force</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>如果 <code>force</code> 字段为 <code>false</code>（或未设置）并且存在子资源，则 API <font color=#c5221f>必须</font>失败，并返回 <code>FAILED_PRECONDITION</code> 错误。</p><h3 id=受保护的删除>受保护的删除</h3><p>有时，用户可能需要确保没有对正在删除的资源进行任何更改。如果资源提供了 <a href=#AIP-134 rel>etag</a>，则删除请求<font color=#188038>可以</font>接受 etag（作为必须或可选字段）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>DeleteBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The name of the book to delete.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// Optional. The etag of the book.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// If this is provided, it must match the server&#39;s etag.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>etag</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>如果提供的 etag 与服务器计算的 etag 不匹配，则请求<font color=#c5221f>必须</font>失败，并返回 <code>ABORTED</code> 错误代码。</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#c5221f>必须</font>为 Delete 请求提供 <code>etag</code> 字段。</div></div></div><h3 id=删除如果存在>删除（如果存在）</h3><p>如果服务使用客户端分配的资源名称，Delete 方法<font color=#188038>可以</font>暴露一个 <code>bool allow_missing</code> 字段，这将导致该方法在用户试图删除不存在的资源时成功（在这种情况下，请求是无操作的）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>DeleteBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to delete.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// If set to true, and the book is not found, the request will succeed
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// but no action will be taken on the server
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>bool</span> <span class=n>allow_missing</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>更具体地说，<code>allow_missing</code> 标志触发以下行为：</p><ul><li>如果方法调用位于不存在的资源上，则请求是无操作的。<ul><li><code>etag</code> 字段被忽略。</li></ul></li><li>如果方法调用位于已存在的资源上，则会删除该资源（接受其他检查）。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#f57c00>应该</font>公开 <code>bool allow_missing</code> 字段。</div></div></div><h3 id=错误-4>错误</h3><p>如果用户没有访问该资源的权限，无论该资源是否存在，该服务都<font color=#c5221f>必须</font>返回 <code>PERMISSION_DENIED</code>（HTTP 403）错误。在检查资源是否存在之前，<font color=#c5221f>必须</font>检查权限。</p><p>如果用户确实具有适当的权限，但所请求的资源不存在，则除非 <code>allow_missing</code> 设置为 <code>true</code>，否则服务<font color=#c5221f>必须</font>返回 <code>NOT_FOUND</code>（HTTP 404）错误。</p><h3 id=延伸阅读-2>延伸阅读</h3><ul><li>有关软删除和取消删除，请参阅 <a href=#AIP-164 rel>AIP-164</a>。</li><li>有关基于筛选器批量删除资源的信息，请参阅 <a href=#AIP-165 rel>AIP-165</a>。</li></ul><h3 id=changelog-4>Changelog</h3><ul><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2022-02-02: Changed eTag error from <code>FAILED_PRECONDITION</code> to <code>ABORTED</code> making it consistent with change to <a href=%28#AIP-154%29 rel>AIP-154</a> & <a href=#AIP-134 rel>AIP-134</a> on 2021-03-05.</li><li>2020-10-06: Added guidance for declarative-friendly resources.</li><li>2020-10-06: Added guidance for allowing no-op delete for missing resources.</li><li>2020-10-06: Moved soft delete and undelete guidance into a new <a href=#AIP-164 rel>AIP-164</a>.</li><li>2020-06-08: Added guidance for Get of soft-deleted resources.</li><li>2020-02-03: Added guidance for error cases.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-06-10: Added guidance for long-running delete.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2024-08-07&nbsp;<a class=git-hash href=https://github.com/saltfishpr/saltfishpr.github.io/commit/b000b0681b38dec69d94a962b85e742a9a19140a target=_blank title="commit by saltfishpr(526191197@qq.com) b000b0681b38dec69d94a962b85e742a9a19140a: update">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>b000b06</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/2023-04-04-google-aip/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP" data-via=saltfishpr data-hashtags="api design"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-hashtag="api design"><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/api-design/>Api Design</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/2023-04-04-grpc-jwt-auth/ class=prev rel=prev title="gRPC JWT Auth"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>gRPC JWT Auth</a>
<a href=/posts/2024-01-31-photograph-2023/ class=next rel=next title="My Photograph in 2023">My Photograph in 2023<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.134.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/saltfishpr target=_blank>SaltFish</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.7b0408f98c705b0bc4a799d0202fa56eb3205ac5921eabd9361c0b6788f342f09cb993017c67db1e9a9cc94773fbd5719a10c007bda24312630eb81919b8b8a1.js integrity="sha512-ewQI+YxwWwvEp5nQIC+lbrMgWsWSHqvZNhwLZ4jzQvCcuZMBfGfbHpqcyUdz+9VxmhDAB72iQxJjDrgZGbi4oQ=="></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.44cc20d57e608bab50bef59d85dcad5ee408c14d4cee68ffd95db180d6641311aa91c0ed72c255a75aa668c31358417f08957b7c106045ec6a1c9bc554151587.js integrity="sha512-RMwg1X5gi6tQvvWdhdytXuQIwU1M7mj/2V2xgNZkExGqkcDtcsJVp1qmaMMTWEF/CJV7fBBgRexqHJvFVBUVhw=="></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{gitalk:{admin:["saltfishpr"],clientID:"60fcbf378ba98da93c38",clientSecret:"97006a937aa9fd569bd7f7c6f1dfa69e39c45a2a",id:"2023-04-04T16:03:42Z",owner:"saltfishpr",repo:"saltfishpr.github.io",title:"Google AIP"}},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.f1b10c54ef8e7ea0c938baba89a68e47962cb91f87edfcf0ae7abf0ec7bbb510e5d980a2b5a69686d7a44eae747183e3ed5cd960ed6fe66552c947e6fca4ff67.js integrity="sha512-8bEMVO+OfqDJOLq6iaaOR5YsuR+H7fzwrnq/Dse7tRDl2YCitaaWhtekTq50cYPj7VzZYO1v5mVSyUfm/KT/Zw=="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9Y9L3W36VM",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9Y9L3W36VM" async></script></body></html>