<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Google AIP - 咸鱼硕的博客</title><meta name=Description content="咸鱼硕的博客"><meta property="og:title" content="Google AIP"><meta property="og:description" content="AIP (API Improvement Proposals) 是总结 Google API 设计决策的设计文档。
这里提供了一些常用文档的翻译。"><meta property="og:type" content="article"><meta property="og:url" content="https://saltfishpr.github.io/posts/2023-04-04-google-aip/"><meta property="og:image" content="https://saltfishpr.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-04T16:03:42+00:00"><meta property="article:modified_time" content="2023-04-05T03:43:11+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://saltfishpr.github.io/logo.png"><meta name=twitter:title content="Google AIP"><meta name=twitter:description content="AIP (API Improvement Proposals) 是总结 Google API 设计决策的设计文档。
这里提供了一些常用文档的翻译。"><meta name=application-name content="咸鱼硕的博客"><meta name=apple-mobile-web-app-title content="咸鱼硕的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=go.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://saltfishpr.github.io/posts/2023-04-04-google-aip/><link rel=prev href=https://saltfishpr.github.io/posts/2023-04-04-grpc-jwt-auth/><link rel=stylesheet href=/css/style.min.61c0835a1733ac3f92b41b61b403dca9b8d4a3a7e4021c89af2c45a731f6343a82bc7fb214f4926e2c4669c8d258218b7da5d0e86d081ec97f3c1d823d48df2e.css integrity="sha512-YcCDWhczrD+StBthtAPcqbjUo6fkAhyJryxFpzH2NDqCvH+yFPSSbixGacjSWCGLfaXQ6G0IHsl/PB2CPUjfLg=="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Google AIP","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/saltfishpr.github.io\/posts\/2023-04-04-google-aip\/"},"image":["https:\/\/saltfishpr.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"api design","wordcount":5033,"url":"https:\/\/saltfishpr.github.io\/posts\/2023-04-04-google-aip\/","datePublished":"2023-04-04T16:03:42+00:00","dateModified":"2023-04-05T03:43:11+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/saltfishpr.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"Salt Fish"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=咸鱼硕的博客><span class=header-title-pre><i class="fas fa-code"></i></span>咸鱼硕的博客</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title=选择语言><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/posts/2023-04-04-google-aip/ selected>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=咸鱼硕的博客><span class=header-title-pre><i class="fas fa-code"></i></span>咸鱼硕的博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/posts/2023-04-04-google-aip/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Google AIP</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/saltfishpr title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Salt Fish</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/programming/><i class="far fa-folder fa-fw" aria-hidden=true></i>Programming</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-04-04>2023-04-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 5033 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 11 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#AIP-1><strong>AIP-1</strong> AIP 目的和指南</a></li><li><a href=#AIP-131><strong>AIP-131</strong> 标准方法：获取（Standard methods: Get）</a><ul><li><a href=#指导>指导</a></li><li><a href=#请求消息>请求消息</a></li><li><a href=#错误>错误</a></li><li><a href=#changelog>Changelog</a></li></ul></li><li><a href=#AIP-132><strong>AIP-132</strong> 标准方法：列表（Standard methods: List）</a><ul><li><a href=#指导-1>指导</a></li><li><a href=#请求消息-1>请求消息</a></li><li><a href=#响应消息>响应消息</a></li><li><a href=#排序>排序</a></li><li><a href=#过滤>过滤</a></li><li><a href=#软删除的资源>软删除的资源</a></li><li><a href=#错误-1>错误</a></li><li><a href=#延伸阅读>延伸阅读</a></li><li><a href=#changelog-1>Changelog</a></li></ul></li><li><a href=#AIP-133><strong>AIP-133</strong> 标准方法：创建（Standard methods: Create）</a><ul><li><a href=#指导-2>指导</a></li><li><a href=#请求消息-2>请求消息</a></li><li><a href=#长时间运行的创建long-running-create>长时间运行的创建（Long-running create）</a></li><li><a href=#用户指定的-id>用户指定的 ID</a></li><li><a href=#错误-2>错误</a></li><li><a href=#延伸阅读-1>延伸阅读</a></li><li><a href=#changelog-2>Changelog</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><a href=https://google.aip.dev/general target=_blank rel="noopener noreffer">AIP</a> (API Improvement Proposals) 是总结 Google API 设计决策的设计文档。</p><p>这里提供了一些常用文档的翻译。</p><h2 id=AIP-1><strong>AIP-1</strong> AIP 目的和指南</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>随着谷歌 API 语料库的发展，以及 API 治理团队的壮大，以满足支持它们的需求，越来越有必要为 API 生产者、审查者和其他相关方提供文档语料库以供参考。API 风格指南和介绍性的 One Platform 文档有意简洁而高级。AIP 集合提供了一种为 API 设计指南提供一致文档的方法。</p><h2 id=AIP-131><strong>AIP-131</strong> 标准方法：获取（Standard methods: Get）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在 REST API 中，为了检索资源，通常会向资源的 URI（例如 <code>/v1/publisher/{publisher}/books/{book}</code>）发出 <code>GET</code> 请求。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>Get</code> 方法来尊重这种设计模式。这些 RPC 接受表示该资源的 URI 并返回该资源。</p><h3 id=指导>指导</h3><p>API <font color=#c5221f>必须</font>为资源提供一个 get 方法。get 方法的目的是从单个资源返回数据。</p><p>Get 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>GetBook</span><span class=p>(</span><span class=n>GetBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Book</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>get</span><span class=o>:</span> <span class=s>&#34;/v1/{name=publishers/*/books/*}&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;name&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以 <code>Get</code> 一词开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是资源消息名称的单数形式。</li><li>请求消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 后缀。</li><li>响应消息<font color=#c5221f>必须</font>是资源本身。（没有 <code>GetBookResponse</code>。）<ul><li>响应通常应包括完全填充的资源，除非有理由返回部分响应（见 <a href=#AIP-157 rel>AIP-157</a>）。</li></ul></li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>GET</code>。</li><li>URI <font color=#f57c00>应该</font>包含与资源名称相对应的单个变量字段。<ul><li>此字段应称为 <code>name</code>。</li><li>URI <font color=#f57c00>应该</font>有一个与此字段相对应的变量。</li><li><code>name</code> 字段<font color=#f57c00>应该</font>是 URI 路径中唯一的变量。所有剩余的参数都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li></ul></li><li><code>google.api.http</code> 注解中<font color=#c5221f>不能</font>有 <code>body</code> 键。</li><li><font color=#f57c00>应该</font>只有一个值为 <code>"name"</code> 的 <code>google.api.method_signature</code> 注解。</li></ul><h3 id=请求消息>请求消息</h3><p>Get 方法实现了一个通用的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>GetBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The name of the book to retrieve.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}/books/{book}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>name</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><font color=#c5221f>必须</font>包含资源名称字段。它<font color=#f57c00>应该</font>被称为 name。<ul><li><font color=#f57c00>应该</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识其引用的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li><code>name</code> 字段的注释<font color=#f57c00>应该</font>记录资源模式。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除其他 AIP 中描述的字段之外的其他可选字段。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>请求对象中的 <code>name</code> 字段对应于 RPC 上 <code>google.api.http</code> 注解中的 <code>name</code> 变量。因为在使用 REST/JSON 接口时，根据 URL 中的值填充 request 中的 <code>name</code> 字段。</div></div></div><h3 id=错误>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><h3 id=changelog>Changelog</h3><ul><li>2023-03-17: Align with AIP-122 and make Get a must.</li><li>2022-11-04: Aggregated error guidance to AIP-193.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-12: Added guidance for error cases.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul><h2 id=AIP-132><strong>AIP-132</strong> 标准方法：列表（Standard methods: List）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在许多 API 中，通常会向集合的 URI（例如 <code>/v1/publisher/1/books</code>）发出 <code>GET</code> 请求，以便检索资源列表，每个资源都位于该集合中。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>List</code> 方法来尊重这种设计模式。这些 RPC 接受父集合（可能还有一些其他参数），并返回与该输入匹配的响应列表。</p><h3 id=指导-1>指导</h3><p>API <font color=#c5221f>必须</font>为资源提供 <code>List</code> 方法，除非资源是<a href=#AIP-156 rel>单例</a>。<code>List</code> 方法的目的是从有限集合返回数据（通常是单个集合，除非操作支持<a href=#AIP-159 rel>跨集合读取</a>）。</p><p>List 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>ListBooks</span><span class=p>(</span><span class=n>ListBooksRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>ListBooksResponse</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>get</span><span class=o>:</span> <span class=s>&#34;/v1/{parent=publishers/*}/books&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;parent&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以单词 <code>List</code> 开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是所列资源的复数形式。</li><li>请求和响应消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 和 <code>Response</code> 后缀。</li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>GET</code>。</li><li>列出其资源的集合<font color=#f57c00>应该</font>映射到 URI 路径。<ul><li>集合的父资源<font color=#f57c00>应</font>称为 <code>parent</code>，并且<font color=#f57c00>应</font>是 URI 路径中唯一的变量。所有剩余的参数都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li><li>集合标识符（上例中的 books）<font color=#c5221f>必须</font>是一个文本字符串。</li></ul></li><li><code>google.api.http</code> 注解中的 <code>body</code> 键<font color=#c5221f>必须</font>省略。</li><li>如果列出的资源不是顶级资源，那么<font color=#f57c00>应该</font>只有一个值为 <code>"parent"</code> 的 <code>google.api.method_signature</code> 注解。如果列出的资源是顶级资源，则<font color=#f57c00>应该</font>没有 <code>google.api.method_signature</code> 注解，或者只有一个值为 <code>""</code> 的 <code>google.api.method_signature</code> 注解。</li></ul><h3 id=请求消息-1>请求消息</h3><p>List 方法实现了一种常见的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>ListBooksRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The parent, which owns this collection of books.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>parent</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>child_type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The maximum number of books to return. The service may return fewer than
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// this value.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// If unspecified, at most 50 books will be returned.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// The maximum value is 1000; values above 1000 will be coerced to 1000.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int32</span> <span class=n>page_size</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// A page token, received from a previous `ListBooks` call.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Provide this to retrieve the subsequent page.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// When paginating, all other parameters provided to `ListBooks` must match
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// the call that provided the page token.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>page_token</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>除非列出的资源是顶级资源，否则<font color=#c5221f>必须</font>包括 <code>parent</code> 字段。它应该被称为 <code>parent</code>。<ul><li><font color=#f57c00>应</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识所列资源的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li><font color=#c5221f>必须</font>在所有列表请求消息上指定支持分页的 <code>page_size</code> 和 <code>page_token</code> 字段。有关更多信息，请参阅 <a href=#AIP-158 rel>AIP-158</a>。<ul><li><code>page_size</code> 字段上方的注释<font color=#f57c00>应</font>记录允许的最大值，以及省略（或设置为 <code>0</code>）字段时的默认值。如果首选(<em>If preferred</em>)，API <font color=#188038>可以</font>声明服务器将使用合理的默认值。此默认值<font color=#188038>可</font>会随着时间的推移而更改。</li><li>如果用户提供的值大于允许的最大值，则 API <font color=#f57c00>应</font>将该值强制为允许的最大。</li><li>如果用户提供了负值或其他无效值，则 API <font color=#c5221f>必须</font>发送 <code>INVALID_ARGUMENT</code> 错误。</li></ul></li><li><code>page_token</code> 字段<font color=#c5221f>必须</font>包含在所有列表请求消息中。</li><li>请求消息<font color=#188038>可以</font>包括与列表方法相关的常见设计模式的字段，例如 <code>string filter</code> 和 <code>string order_by</code>。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除本 AIP 或其他 AIP 中描述的字段之外的其他可选字段。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>对于任何有权对集合成功发出 List 请求的用户，List 方法都<font color=#f57c00>应该</font>返回相同的结果。Search 方法在这方面比较宽松。</div></div></div><h3 id=响应消息>响应消息</h3><p>List 方法实现了一个通用的响应消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>ListBooksResponse</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The books from the specified publisher.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>repeated</span> <span class=n>Book</span> <span class=n>books</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// A token, which can be sent as `page_token` to retrieve the next page.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// If this field is omitted, there are no subsequent pages.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>next_page_token</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>响应消息<font color=#c5221f>必须</font>包括一个与返回的资源相对应的重复字段，并且<font color=#f57c00>不应</font>包括任何其他重复字段，除非在另一个 AIP（例如，<a href=#AIP-217 rel>AIP-217</a>）中描述。<ul><li>响应通常<font color=#f57c00>应</font>包括完全填充的资源，除非有理由返回部分响应（见 <a href=#AIP-157 rel>AIP-157</a>）。</li></ul></li><li>支持分页的 <code>next_page_token</code> 字段<font color=#c5221f>必须</font>包含在所有列表响应消息中。如果有后续页面，则<font color=#c5221f>必须</font>设置它，如果响应表示最终页面，则<font color=#c5221f>不得</font>设置它。有关更多信息，请参阅 <a href=#AIP-158 rel>AIP-158</a>。</li><li>该消息<font color=#188038>可以</font>包括具有集合中的项数的 <code>int32 total_size</code>（或 <code>int64 total_size</code>）字段。<ul><li>该值<font color=#188038>可以</font>是一个估计值（如果是的话，字段<font color=#f57c00>应该</font>清楚地记录在文档中）。</li><li>如果使用筛选，则 <code>total_size</code> 字段<font color=#f57c00>应</font>反映应用筛选后集合的大小。</li></ul></li></ul><h3 id=排序>排序</h3><p><code>List</code> 方法<font color=#188038>可以</font>允许客户端指定排序顺序；如果他们这样做了，那么请求消息<font color=#f57c00>应该</font>包含一个 <code>string order_by</code> 字段。</p><ul><li>值<font color=#f57c00>应该</font>是以逗号分隔的字段列表。例如：<code>"foo,bar"</code>。</li><li>默认的排序顺序是升序。为了指定字段的降序，用户会附加一个 <code>" desc"</code> 后缀；例如：<code>"foo desc, bar"</code>。</li><li>语法中多余的空格字符是无关紧要的。<code>"foo, bar desc"</code>、<code>" foo , bar desc "</code>和 <code>"foo,bar desc"</code> 都是等价的。</li><li>子字段是用指定的。字符，例如 <code>foo.bar</code> 或 <code>address.street</code>。</li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>只有在确定需要的情况下才提供排序。以后随时可以添加排序，但删除它是一个破坏性的改变。</div></div></div><h3 id=过滤>过滤</h3><p><code>List</code> 方法<font color=#188038>可以</font>允许客户端指定筛选器；如果他们这样做了，那么请求消息应该包含一个 <code>string filter</code> 字段。过滤在 <a href=#AIP-160 rel>AIP-160</a> 中有更详细的描述。</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>只有在确定需要的情况下才提供筛选。以后随时是可以添加筛选，但删除它是一个突破性的改变。</div></div></div><h3 id=软删除的资源>软删除的资源</h3><p>一些 API 需要“<a href=#AIP-135 rel>软删除</a>”资源，将其标记为已删除或待删除（并可选择稍后清除）。</p><p>默认情况下，执行此操作的 API <font color=#f57c00>不应</font>在列表请求中包括已删除的资源。具有软删除资源的 API <font color=#f57c00>应</font>在列表请求中包括一个 <code>bool show_deleted</code> 字段，如果设置该字段，将导致软删除的资源被包括在内。</p><h3 id=错误-1>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><h3 id=延伸阅读>延伸阅读</h3><ul><li>有关分页的详细信息，请参阅 <a href=#AIP-158 rel>AIP-158</a>。</li><li>有关跨多个父集合的列表，请参见 <a href=#AIP-159 rel>AIP-159</a>。</li></ul><h3 id=changelog-1>Changelog</h3><ul><li>2023-03-22: Fix guidance wording to mention AIP-159.</li><li>2023-03-17: Align with AIP-122 and make Get a must.</li><li>2022-11-04: Aggregated error guidance to AIP-193.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2020-09-02: Add link to the filtering AIP.</li><li>2020-08-14: Added error guidance for permission denied cases.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2020-05-19: Removed requirement to document ordering behavior.</li><li>2020-04-15: Added guidance on List permissions.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-07-30: Added guidance about documenting the ordering behavior.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul><h2 id=AIP-133><strong>AIP-133</strong> 标准方法：创建（Standard methods: Create）</h2><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw" aria-hidden=true></i>信息<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>翻译时间：2023-04-05</div></div></div><p>在 REST API 中，通常会向集合的 URI（例如 <code>/v1/publisher/{publisher}/books</code>）发出 <code>POST</code> 请求，以便在该集合中创建新的资源。</p><p>面向资源的设计（<a href=#AIP-121 rel>AIP-121</a>）通过 <code>Create</code> 方法来尊重这种设计模式。这些 RPC 接受父集合和要创建的资源（可能还有一些其他参数），并返回创建的资源。</p><h3 id=指导-2>指导</h3><p>API 通常<font color=#f57c00>应该</font>为资源提供一个<em>创建</em>方法，除非这样做对用户来说没有价值。<em>创建</em>方法的目的是在已经存在的集合中创建一个新的资源。</p><p>Create 方法是使用以下模式指定的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>CreateBook</span><span class=p>(</span><span class=n>CreateBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>Book</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>post</span><span class=o>:</span> <span class=s>&#34;/v1/{parent=publishers/*}/books&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>body</span><span class=o>:</span> <span class=s>&#34;book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.method_signature</span><span class=p>)</span> <span class=o>=</span> <span class=s>&#34;parent,book&#34;</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>RPC 的名称<font color=#c5221f>必须</font>以 <code>Create</code> 一词开头。RPC 名称的其余部分<font color=#f57c00>应该</font>是正在创建的资源的单数形式。</li><li>请求消息<font color=#c5221f>必须</font>与 RPC 名称匹配，并带有 <code>Request</code> 后缀。</li><li>响应消息<font color=#c5221f>必须</font>是资源本身。没有 <code>CreateBookResponse</code>。<ul><li>响应<font color=#f57c00>应</font>包括完全填充的资源，并且<font color=#c5221f>必须</font>包括所提供的任何字段，除非它们仅是输入的（见 <a href=#AIP-203 rel>AIP-203</a>）。</li><li>如果创建 RPC 是长时间运行的，则响应消息<font color=#c5221f>必须</font>是解析为资源本身的 <code>google.longrunning.Operation</code>。</li></ul></li><li>HTTP 谓词<font color=#c5221f>必须</font>是 <code>POST</code>。</li><li>添加资源的集合<font color=#f57c00>应该</font>映射到 URI 路径。<ul><li>集合的父资源<font color=#f57c00>应</font>称为 <code>parent</code>，并且<font color=#f57c00>应</font>是 URI 路径中唯一的变量。</li><li>集合标识符（上例中的 <code>books</code>）<font color=#c5221f>必须</font>是一个文本字符串。</li></ul></li><li><code>google.api.http</code> 注解中<font color=#c5221f>必须</font>有一个 <code>body</code> 键，并且它<font color=#c5221f>必须</font>映射到请求消息中的资源字段。<ul><li>所有剩余的字段都<font color=#f57c00>应该</font>映射到 URI 查询参数。</li></ul></li><li><font color=#f57c00>应该</font>只有一个 <code>google.api.method_signature</code> 注解，如果要创建的资源不是顶级资源，则其值为 <code>"parent，{resource}"</code>，如果正在创建的资源是顶级资源（除非该方法支持<a href=#AIP-133 rel>用户指定的 ID</a>），则该注解的值为 <code>"{resource}"</code>。</li></ul><h3 id=请求消息-2>请求消息</h3><p>Create 方法实现一个通用的请求消息模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>CreateBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The parent resource where this book will be created.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>parent</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>child_type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to create.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=mi>2</span> <span class=p>[(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>除非正在创建的资源是顶级资源，否则<font color=#c5221f>必须</font>包括 <code>parent</code> 字段。它<font color=#f57c00>应该</font>被称为 <code>parent</code>。<ul><li><font color=#f57c00>应</font>根据需要对字段进行<a href=#AIP-203 rel>注释</a>。</li><li>字段<font color=#c5221f>必须</font>标识正在创建的资源的<a href=#AIP-123 rel>资源类型</a>。</li></ul></li><li>资源字段<font color=#c5221f>必须</font>包含在内，并且<font color=#c5221f>必须</font>映射到 POST body。</li><li>请求消息<font color=#c5221f>不得</font>包含任何其他必需字段，也<font color=#f57c00>不应</font>包含除本 AIP 或其他 AIP 中描述的字段之外的其他可选字段。</li></ul><h3 id=长时间运行的创建long-running-create>长时间运行的创建（Long-running create）</h3><p>有些资源创建资源所花费的时间比常规 API 请求所需的时间更长。在这种情况下，API <font color=#f57c00>应该</font>使用长时间运行的操作（<a href=#AIP-151 rel>AIP-151</a>）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=k>rpc</span> <span class=n>CreateBook</span><span class=p>(</span><span class=n>CreateBookRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>google.longrunning.Operation</span><span class=p>)</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.api.http</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>post</span><span class=o>:</span> <span class=s>&#34;/v1/{parent=publishers/*}/books&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=k>option</span> <span class=p>(</span><span class=n>google.longrunning.operation_info</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>response_type</span><span class=o>:</span> <span class=s>&#34;Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=n>metadata_type</span><span class=o>:</span> <span class=s>&#34;OperationMetadata&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=p>};</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>响应类型<font color=#c5221f>必须</font>设置为资源（如果 RPC 不是长时间运行的，则返回类型是什么）。</li><li><font color=#c5221f>必须</font>同时指定 <code>response_type</code> 和 <code>metadata_type</code> 字段。</li></ul><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>重要<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）<font color=#f57c00>应该</font>使用长时间运行的操作。如果请求实际上是即时的，则服务<font color=#188038>可以</font>返回已经设置为完成的 LRO。</div></div></div><h3 id=用户指定的-id>用户指定的 ID</h3><p>有时，API 需要允许客户端在创建时指定资源的 ID 组件（资源名称的最后一段）。如果允许用户选择其资源名称的这一部分，这是很常见的。</p><p>例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>// Using user-specified IDs.
</span></span><span class=line><span class=cl>publishers/lacroix/books/les-miserables
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// Using system-generated IDs.
</span></span><span class=line><span class=cl>publishers/012345678-abcd-cdef/books/12341234-5678-abcd
</span></span></code></pre></td></tr></table></div></div><p>创建 RPC <font color=#188038>可以</font>通过在请求消息上提供字符串 <code>{resource}_id</code> 字段来支持此行为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-protobuf data-lang=protobuf><span class=line><span class=cl><span class=kd>message</span> <span class=nc>CreateBookRequest</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The parent resource where this book will be created.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// Format: publishers/{publisher}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>parent</span> <span class=o>=</span> <span class=mi>1</span> <span class=p>[</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>,</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>(</span><span class=n>google.api.resource_reference</span><span class=p>)</span> <span class=o>=</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>      <span class=n>child_type</span><span class=o>:</span> <span class=s>&#34;library.googleapis.com/Book&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    <span class=p>}];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The book to create.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Book</span> <span class=n>book</span> <span class=o>=</span> <span class=mi>2</span> <span class=p>[(</span><span class=n>google.api.field_behavior</span><span class=p>)</span> <span class=o>=</span> <span class=n>REQUIRED</span><span class=p>];</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// The ID to use for the book, which will become the final component of
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// the book&#39;s resource name.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// This value should be 4-63 characters, and valid characters
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// are /[a-z][0-9]-/.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>string</span> <span class=n>book_id</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><code>{resource}_id</code> 字段<font color=#c5221f>必须</font>存在于请求消息中，而不是资源本身。<ul><li>该字段<font color=#188038>可能</font>是必需的，也可能是可选的。如果需要，它<font color=#f57c00>应该</font>包括相应的注释。</li></ul></li><li><font color=#c5221f>必须</font>忽略资源上的 <code>name</code> 字段。</li><li>RPC 上<font color=#f57c00>应该</font>只有一个 <code>google.api.method_signature</code> 注解，如果正在创建的资源不是顶级资源，则其值为 <code>"parent,{resource},{resource}_id"</code>；如果要创建的资源是顶级资源，其值应为 <code>"{resource},{resource}_id"</code>。</li><li>文档<font color=#f57c00>应</font>解释什么是可接受的格式，并且该格式<font color=#f57c00>应</font>遵循 <a href=#AIP-122 rel>AIP-122</a> 中的资源名称格式指南。</li><li>如果用户试图创建一个 ID 会导致资源名称重复的资源，则该服务<font color=#c5221f>必须</font>返回 <code>ALREADY_EXISTS</code> 错误。<ul><li>但是，如果进行调用的用户没有查看重复资源的权限，则服务<font color=#c5221f>必须</font>改为使用 <code>PERMISSION_DENIED</code>。</li></ul></li></ul><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>注意<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>对于 REST API，用户指定的 ID 字段 <code>{resource}_id</code> 作为请求 URI 上的查询参数提供。</div></div></div><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>重要<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>声明性友好资源（<a href=#AIP-128 rel>AIP-128</a>）必须支持用户指定的 ID。</div></div></div><h3 id=错误-2>错误</h3><p>请参阅<a href=#AIP-193 rel>errors</a>，特别是何时使用 <code>PERMISSION_DENIED</code> 和 <code>NOT_FOUND</code> 错误。</p><h3 id=延伸阅读-1>延伸阅读</h3><ul><li>要确保 <code>Create</code> 方法中的幂等性，请参见 <a href=#AIP-155 rel>AIP-155</a>。</li><li>有关涉及 Unicode 的命名资源，请参见 <a href=#AIP-210 rel>AIP-210</a>。</li></ul><h3 id=changelog-2>Changelog</h3><ul><li>2022-11-04: Referencing aggregated error guidance in AIP-193, similar to other CRUDL AIPs.</li><li>2022-06-02: Changed suffix descriptions to eliminate superfluous &ldquo;-&rdquo;.</li><li>2020-10-06: Added declarative-friendly guidance.</li><li>2020-08-14: Updated error guidance to use permission denied over forbidden.</li><li>2020-06-08: Added guidance on returning the full resource.</li><li>2019-11-22: Added clarification on what error to use if a duplicate name is sent.</li><li>2019-10-18: Added guidance on annotations.</li><li>2019-08-01: Changed the examples from &ldquo;shelves&rdquo; to &ldquo;publishers&rdquo;, to present a better example of resource ownership.</li><li>2019-06-10: Added guidance for long-running create.</li><li>2019-05-29: Added an explicit prohibition on arbitrary fields in standard methods.</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-04-05&nbsp;<a class=git-hash href=https://github.com/saltfishpr/saltfishpr.github.io/commit/162e48730c665601bed396568275c4b15dd7be66 target=_blank title="commit by saltfishpr(526191197@qq.com) 162e48730c665601bed396568275c4b15dd7be66: update">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>162e487</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/2023-04-04-google-aip/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP" data-via=saltfishpr data-hashtags="api design"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-hashtag="api design"><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://saltfishpr.github.io/posts/2023-04-04-google-aip/ data-title="Google AIP"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/api-design/>api design</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/2023-04-04-grpc-jwt-auth/ class=prev rel=prev title="gRPC JWT Auth"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>gRPC JWT Auth</a></div></div><div id=comments><div id=gitalk class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://github.com/gitalk/gitalk></a>Gitalk</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/saltfishpr target=_blank>SaltFish</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.7b0408f98c705b0bc4a799d0202fa56eb3205ac5921eabd9361c0b6788f342f09cb993017c67db1e9a9cc94773fbd5719a10c007bda24312630eb81919b8b8a1.js integrity="sha512-ewQI+YxwWwvEp5nQIC+lbrMgWsWSHqvZNhwLZ4jzQvCcuZMBfGfbHpqcyUdz+9VxmhDAB72iQxJjDrgZGbi4oQ=="></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.918bdd059e2c518e24c32fb5fd89144a49778f21f2166db93bf1e2ed311b3589660feb5777210257aee209f6d8bdde8c296883e34ff8bf4d5338f4be53132976.js integrity="sha512-kYvdBZ4sUY4kwy+1/YkUSkl3jyHyFm25O/Hi7TEbNYlmD+tXdyECV67iCfbYvd6MKWiD40/4v01TOPS+UxMpdg=="></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{gitalk:{admin:["saltfishpr"],clientID:"60fcbf378ba98da93c38",clientSecret:"97006a937aa9fd569bd7f7c6f1dfa69e39c45a2a",id:"2023-04-04T16:03:42Z",owner:"saltfishpr",repo:"saltfishpr.github.io",title:"Google AIP"}},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.2970a33d719df7cd89cebf586152b32a8ed30012227fa81b44282950146e0f595d1c733779e4d423dda1004bdcf707ee64d0fadc3d21229cd66b960788f84bdb.js integrity="sha512-KXCjPXGd982Jzr9YYVKzKo7TABIif6gbRCgpUBRuD1ldHHM3eeTUI92hAEvc9wfuZND63D0hIpzWa5YHiPhL2w=="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-160062007-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-160062007-1" async></script></body></html>